<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Squirtle Tamagotchi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap');
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        :root{--bg:#e8e8e0;--screen:#c4cfa1;--screen-dark:#9baa7c;--text:#2d2d2d;--border:#1a1a1a}
        html,body{height:100%;overflow:hidden}
        body{font-family:'VT323',monospace;background:var(--bg);display:flex;flex-direction:column;color:var(--text)}
        .game{flex:1;display:flex;flex-direction:column;max-width:500px;width:100%;margin:0 auto;padding:8px;height:100vh}
        .screen{flex:1;background:var(--screen);border:3px solid var(--border);border-radius:8px;padding:10px;display:flex;flex-direction:column;min-height:0}
        .header{display:flex;justify-content:space-between;margin-bottom:8px;font-size:16px}
        .name{font-family:'Press Start 2P',monospace;font-size:14px;text-transform:uppercase}
        .lvl{background:var(--screen-dark);padding:2px 6px;border-radius:4px;font-size:12px;margin-top:4px;display:inline-block}
        .hdr-r{text-align:right;font-size:14px}
        .hdr-r div{margin-bottom:2px}
        .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:5px;margin-bottom:8px}
        .stat{display:flex;align-items:center;gap:4px;font-size:14px}
        .stat svg{width:16px;height:16px;fill:var(--text)}
        .track{flex:1;height:12px;background:var(--screen-dark);border-radius:3px;overflow:hidden;border:1px solid var(--text)}
        .fill{height:100%;transition:width 0.5s}
        .fill.hunger{background:#6b8e4e}.fill.happy{background:#c9a857}.fill.energy{background:#5a7a9e}.fill.health{background:#9e5a5a}
        .arena{flex:1;background:var(--screen-dark);border-radius:8px;display:flex;justify-content:center;align-items:center;position:relative;margin-bottom:8px;border:2px solid var(--text);overflow:hidden;min-height:120px}
        .sprite {
            width: 300px;
            height: 300px;
            image-rendering: pixelated;
            transition: none;
        }
        .status{display:flex;justify-content:space-between;align-items:center;font-size:14px;padding:6px 10px;background:var(--screen-dark);border-radius:4px;margin-bottom:8px}
        .mood{display:flex;align-items:center;gap:6px}
        .mood svg{width:20px;height:20px;fill:var(--text)}
        .time{font-family:'Press Start 2P',monospace;font-size:12px}
        .msg{background:var(--bg);border:2px solid var(--text);border-radius:6px;padding:10px 12px;font-size:16px;min-height:50px;display:flex;align-items:center;justify-content:center;text-align:center}
        .ctrls{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:8px}
        .btn{background:linear-gradient(145deg,#d8d8d0,#c0c0b8);border:2px solid var(--border);border-radius:8px;padding:10px 6px;font-family:'VT323',monospace;font-size:14px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;box-shadow:0 3px 0 var(--border);color:var(--text)}
        .btn:active{transform:translateY(2px);box-shadow:0 1px 0 var(--border)}
        .btn svg{width:24px;height:24px;fill:var(--text)}
        .ctrls2{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:6px}
        .btn2{background:var(--screen-dark);border:2px solid var(--border);border-radius:6px;padding:8px;font-family:'VT323',monospace;font-size:14px;cursor:pointer;color:var(--text);display:flex;align-items:center;justify-content:center;gap:5px}
        .btn2:active{background:var(--screen)}
        .btn2 svg{width:18px;height:18px;fill:var(--text)}
        .info{font-size:12px;color:#5a5a5a;text-align:center;margin-top:6px;padding-top:6px;border-top:1px dashed #5a5a5a}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:100}
        .modal.on{display:flex}
        .modal-c{background:var(--bg);border:4px solid var(--border);border-radius:12px;padding:20px;max-width:340px;width:90%;max-height:85vh;overflow-y:auto}
        .modal-t{font-family:'Press Start 2P',monospace;font-size:12px;text-align:center;margin-bottom:15px}
        .sleep-opts{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
        .sleep-opt{background:var(--screen);border:3px solid var(--border);border-radius:8px;padding:15px;cursor:pointer;text-align:center;font-size:16px}
        .sleep-opt:active{transform:scale(0.95);background:var(--screen-dark)}
        .notif{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:var(--border);color:var(--bg);padding:8px 16px;border-radius:6px;font-size:14px;z-index:200;animation:notif 0.3s ease}
        @keyframes notif{from{transform:translateX(-50%) translateY(-100%);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}
        .float{position:absolute;font-size:18px;font-weight:bold;color:var(--text);animation:float 1.5s ease forwards;pointer-events:none}
        @keyframes float{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-60px)}}
    </style>
</head>
<body>
<div class="game">
    <div class="screen">
        <div class="header">
            <div>
                <div class="name" id="name">Squirtle</div>
                <div class="lvl">Lv. <span id="lv">1</span></div>
            </div>
            <div class="hdr-r">
                <div id="exp">EXP: 0/100</div>
                <div>$ <span id="coins">50</span></div>
            </div>
        </div>
        <div class="stats">
            <div class="stat"><svg viewBox="0 0 24 24"><path d="M18.06 23h1.66c.84 0 1.53-.65 1.63-1.47L23 5.05l-5 2 1.06 15.95zM1 22h15.03c.83 0 1.5-.67 1.5-1.5v-1.5H1v3zm14-10H1v2h14v-2zm0-4H1v2h14V8zM1 6h14V4H1v2z"/></svg><div class="track"><div class="fill hunger" id="hBar"></div></div></div>
            <div class="stat"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg><div class="track"><div class="fill happy" id="happBar"></div></div></div>
            <div class="stat"><svg viewBox="0 0 24 24"><path d="M11 21h-1l1-7H7.5c-.88 0-.33-.75-.31-.78C8.48 10.94 10.42 7.54 13.01 3h1l-1 7h3.51c.4 0 .62.19.4.66C12.97 17.55 11 21 11 21z"/></svg><div class="track"><div class="fill energy" id="eBar"></div></div></div>
            <div class="stat"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><div class="track"><div class="fill health" id="hlBar"></div></div></div>
        </div>
        <div class="arena" id="arena">
            <img src="pokemons/squirtle/reação feliz.gif" alt="Squirtle" class="sprite" id="sprite">
        </div>
        <div class="status">
            <div class="mood"><span id="moodI"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg></span><span id="moodT">Feliz</span></div>
            <div class="time" id="time">--:--</div>
        </div>
        <div class="msg" id="msg">Bem-vindo! Cuide bem do Squirtle!</div>
    </div>
    <div class="ctrls">
        <button class="btn" id="bFeed"><svg viewBox="0 0 24 24"><path d="M18.06 23h1.66c.84 0 1.53-.65 1.63-1.47L23 5.05l-5 2 1.06 15.95zM1 22h15.03c.83 0 1.5-.67 1.5-1.5v-1.5H1v3zm14-10H1v2h14v-2zm0-4H1v2h14V8zM1 6h14V4H1v2z"/></svg><span>Comida</span></button>
        <button class="btn" id="bPlay"><svg viewBox="0 0 24 24"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg><span>Brincar</span></button>
        <button class="btn" id="bSleep"><svg viewBox="0 0 24 24"><path d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"/></svg><span id="sleepT">Dormir</span></button>
        <button class="btn" id="bHeal"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/></svg><span>Curar</span></button>
    </div>
    <div class="ctrls2">
        <button class="btn2" id="bPet"><svg viewBox="0 0 24 24"><path d="M12.5 2C9.46 2 7 4.46 7 7.5c0 2.7 1.94 4.93 4.5 5.4V15H9v2h2.5v2.5h2V17H16v-2h-2.5v-2.1c2.56-.47 4.5-2.7 4.5-5.4C18 4.46 15.54 2 12.5 2z"/></svg>Carinho</button>
        <button class="btn2" id="bTrain"><svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/></svg>Exercitar</button>
        <button class="btn2" id="bNew"><svg viewBox="0 0 24 24"><path d="M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34A8.014 8.014 0 0 0 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"/></svg>Resetar</button>
    </div>
    <div class="info">Idade: <span id="age">0</span> dias</div>
</div>

<div class="modal" id="sleepModal">
    <div class="modal-c">
        <div class="modal-t">Quanto tempo quer dormir?</div>
        <div class="sleep-opts">
            <button class="sleep-opt" data-min="1">1 min</button>
            <button class="sleep-opt" data-min="5">5 min</button>
            <button class="sleep-opt" data-min="10">10 min</button>
            <button class="sleep-opt" data-min="30">30 min</button>
        </div>
        <button class="btn2" id="sleepCancel" style="margin-top:15px;width:100%">Cancelar</button>
    </div>
</div>

<script>
const ANIMS = {
    happy: 'pokemons/squirtle/reação feliz.gif',
    angry: 'pokemons/squirtle/bravo.gif',
    running: 'pokemons/squirtle/corrida.gif',
    sleeping: 'pokemons/squirtle/dormindo.gif',
    waking: 'pokemons/squirtle/dormindo e acordando.gif',
    medicine: 'pokemons/squirtle/medicine.gif',
    watergun: 'pokemons/squirtle/watergun.gif'
};

let G = {
    lv: 1,
    xp: 0,
    xpMax: 100,
    coins: 50,
    age: 0,
    st: { h: 100, hap: 100, en: 100, hp: 100 },
    status: 'idle',
    lastUpd: Date.now(),
    lastInt: Date.now(),
    start: Date.now(),
    sleepEnd: null,
    trainStart: null
};

let $ = {
    name: document.getElementById('name'),
    sprite: document.getElementById('sprite'),
    lv: document.getElementById('lv'),
    exp: document.getElementById('exp'),
    coins: document.getElementById('coins'),
    age: document.getElementById('age'),
    hBar: document.getElementById('hBar'),
    happBar: document.getElementById('happBar'),
    eBar: document.getElementById('eBar'),
    hlBar: document.getElementById('hlBar'),
    moodI: document.getElementById('moodI'),
    moodT: document.getElementById('moodT'),
    time: document.getElementById('time'),
    msg: document.getElementById('msg'),
    arena: document.getElementById('arena'),
    sleepModal: document.getElementById('sleepModal'),
    sleepT: document.getElementById('sleepT')
};

let loopInt = null;

function init() {
    load();
    setupEvents();
    updTime();
    setInterval(updTime, 1000);
    startLoop();
    updUI();
}

function setupEvents() {
    document.getElementById('bFeed').onclick = feed;
    document.getElementById('bPlay').onclick = play;
    document.getElementById('bSleep').onclick = toggleSleep;
    document.getElementById('bHeal').onclick = heal;
    document.getElementById('bPet').onclick = pet;
    document.getElementById('bTrain').onclick = toggleTrain;
    document.getElementById('bNew').onclick = reset;
    document.getElementById('sleepCancel').onclick = () => $.sleepModal.classList.remove('on');

    document.querySelectorAll('.sleep-opt').forEach(btn => {
        btn.onclick = () => startSleep(parseInt(btn.dataset.min));
    });
}

function startLoop() {
    loopInt = setInterval(loop, 1000);
}

function loop() {
    const now = Date.now();
    const dt = (now - G.lastUpd) / 60000;

    // Treinamento contínuo
    if (G.status === 'training' && G.trainStart) {
        const trainTime = (now - G.trainStart) / 1000; // em segundos
        const expGain = Math.floor(trainTime / 5); // 1 XP a cada 5 segundos

        if (expGain > 0) {
            G.xp += expGain;
            G.trainStart = now;
            G.st.en = Math.max(0, G.st.en - (expGain * 0.5));
            G.st.h = Math.max(0, G.st.h - (expGain * 0.3));
            chkLvUp();

            if (G.st.en <= 0) {
                stopTrain();
                notif('Squirtle esta muito cansado!');
            }
        }
    }

    // Dormir com timer
    if (G.status === 'sleeping' && G.sleepEnd) {
        const timeLeft = G.sleepEnd - now;

        // 10 segundos antes de acordar: troca para animação de acordando
        if (timeLeft > 0 && timeLeft <= 10000 && $.sprite.src.includes('dormindo.gif')) {
            $.sprite.src = ANIMS.waking;
        }

        if (timeLeft <= 0) {
            wakeUp();
        }
    }

    // Decay normal de stats (mais lento)
    if (G.status !== 'sleeping') {
        G.st.h = Math.max(0, G.st.h - dt * 0.15);
        G.st.hap = Math.max(0, G.st.hap - dt * 0.1);

        if (G.status !== 'training') {
            G.st.en = Math.max(0, G.st.en - dt * 0.08);
        }

        if (G.st.h < 20 || G.st.hap < 20) {
            G.st.hp = Math.max(0, G.st.hp - dt * 0.1);
        }
    } else {
        // Dormindo recupera energia
        G.st.en = Math.min(100, G.st.en + dt * 0.8);
    }

    G.age = Math.floor((now - G.start) / 1800000);
    G.lastUpd = now;

    updMood();
    updUI();
    save();
}

function feed() {
    if (G.status === 'sleeping') return notif('Squirtle esta dormindo!');
    if (G.status === 'training') return notif('Squirtle esta se exercitando!');
    if (G.coins < 5) return notif('Sem moedas!');
    if (G.st.h >= 100) return notif('Nao esta com fome!');

    G.coins -= 5;
    G.st.h = Math.min(100, G.st.h + 30);
    G.st.hap = Math.min(100, G.st.hap + 5);
    G.xp += 5;

    $.sprite.src = ANIMS.happy;
    showMsg('Hmm, delicioso!');
    showFloat('+30 Fome');

    setTimeout(() => {
        if (G.status === 'idle') checkDefaultAnim();
    }, 2000);

    chkLvUp();
    updUI();
    G.lastInt = Date.now();
}

function pet() {
    if (G.status === 'sleeping') return notif('Deixe descansar!');
    if (G.status === 'training') return notif('Squirtle esta se exercitando!');

    G.st.hap = Math.min(100, G.st.hap + 10);
    G.xp += 2;

    $.sprite.src = ANIMS.happy;
    showMsg('Adoro carinho!');
    showFloat('+10 Felicidade');

    setTimeout(() => {
        if (G.status === 'idle') checkDefaultAnim();
    }, 1500);

    chkLvUp();
    updUI();
    G.lastInt = Date.now();
}

function toggleTrain() {
    if (G.status === 'training') {
        stopTrain();
    } else {
        startTrain();
    }
}

function startTrain() {
    if (G.status === 'sleeping') return notif('Squirtle esta dormindo!');
    if (G.st.en < 10) return notif('Muito cansado!');

    G.status = 'training';
    G.trainStart = Date.now();
    $.sprite.src = ANIMS.running;
    showMsg('Vamos treinar!');
    document.getElementById('bTrain').querySelector('svg').innerHTML = '<path d="M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2H6z"/>';
    updUI();
}

function stopTrain() {
    G.status = 'idle';
    G.trainStart = null;
    checkDefaultAnim();
    showMsg('Bom treino!');
    document.getElementById('bTrain').querySelector('svg').innerHTML = '<path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/>';
    updUI();
}

function toggleSleep() {
    if (G.status === 'sleeping') {
        wakeUp();
    } else {
        if (G.status === 'training') stopTrain();
        $.sleepModal.classList.add('on');
    }
}

function startSleep(minutes) {
    $.sleepModal.classList.remove('on');
    G.status = 'sleeping';
    G.sleepEnd = Date.now() + (minutes * 60 * 1000);
    $.sprite.src = ANIMS.sleeping;
    $.sleepT.textContent = 'Acordar';
    showMsg('Zzz... Zzz...');
    updUI();
    save();
}

function wakeUp() {
    G.status = 'idle';
    G.sleepEnd = null;
    $.sleepT.textContent = 'Dormir';

    $.sprite.src = ANIMS.waking;
    showMsg('Bom dia!');

    setTimeout(() => {
        checkDefaultAnim();
    }, 3000);

    updUI();
    G.lastInt = Date.now();
    save();
}

function heal() {
    if (G.status === 'training') return notif('Squirtle esta se exercitando!');
    if (G.st.hp >= 100) return notif('Ja esta saudavel!');
    if (G.coins < 20) return notif('Precisa 20 moedas!');

    G.coins -= 20;
    G.st.hp = 100;
    $.sprite.src = ANIMS.medicine;
    showMsg('Me sinto muito melhor!');
    showFloat('+100% Saude');

    setTimeout(() => {
        if (G.status === 'idle') checkDefaultAnim();
    }, 2000);

    updUI();
    G.lastInt = Date.now();
}

function play() {
    if (G.status === 'sleeping') return notif('Squirtle esta dormindo!');
    if (G.status === 'training') return notif('Squirtle esta se exercitando!');
    if (G.st.en < 10) return notif('Muito cansado!');

    G.st.hap = Math.min(100, G.st.hap + 20);
    G.st.en = Math.max(0, G.st.en - 10);
    G.xp += 10;
    G.coins += 5;

    $.sprite.src = ANIMS.watergun;
    showMsg('Water Gun! Isso e divertido!');
    showFloat('+20 Felicidade');

    setTimeout(() => {
        if (G.status === 'idle') checkDefaultAnim();
    }, 3000);

    chkLvUp();
    updUI();
    G.lastInt = Date.now();
}

function checkDefaultAnim() {
    if (G.status !== 'idle') return;

    if (G.st.h < 30 || G.st.hp < 30) {
        $.sprite.src = ANIMS.angry;
    } else {
        $.sprite.src = ANIMS.happy;
    }
}

function chkLvUp() {
    while (G.xp >= G.xpMax) {
        G.xp -= G.xpMax;
        G.lv++;
        G.xpMax = Math.floor(G.xpMax * 1.2);
        notif('Nivel ' + G.lv + '!');
        showMsg('Fiquei mais forte!');
        G.coins += 20;
    }
}

function updUI() {
    $.lv.textContent = G.lv;
    $.exp.textContent = 'EXP: ' + Math.floor(G.xp) + '/' + G.xpMax;
    $.coins.textContent = G.coins;
    $.age.textContent = G.age;
    $.hBar.style.width = G.st.h + '%';
    $.happBar.style.width = G.st.hap + '%';
    $.eBar.style.width = G.st.en + '%';
    $.hlBar.style.width = G.st.hp + '%';
}

function updMood() {
    let m, i;

    if (G.status === 'sleeping') {
        m = 'Dormindo';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-5-5h2v2H7zm8 0h2v2h-2zm-4 1h2v2h-2z"/></svg>';
    } else if (G.status === 'training') {
        m = 'Treinando';
        i = '<svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/></svg>';
    } else if (G.st.hp < 30) {
        m = 'Doente';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-5-6h10v2H7z"/></svg>';
        checkDefaultAnim();
    } else if (G.st.h < 30) {
        m = 'Faminto';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-2.33 0-4.32 1.45-5.12 3.5h1.67c.69-1.19 1.97-2 3.45-2s2.75.81 3.45 2h1.67c-.8-2.05-2.79-3.5-5.12-3.5z"/></svg>';
        checkDefaultAnim();
    } else if (G.st.en < 20) {
        m = 'Exausto';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-5-5h2v2H7zm8 0h2v2h-2zm-4 1h2v2h-2z"/></svg>';
    } else if (G.st.hap < 30) {
        m = 'Triste';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 3c-2.33 0-4.31 1.46-5.11 3.5h10.22c-.8-2.04-2.78-3.5-5.11-3.5z"/></svg>';
    } else if (G.st.hap > 80 && G.st.h > 60) {
        m = 'Muito Feliz';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm1-10.06L14.06 11l1.06-1.06L16.18 11l1.06-1.06-2.12-2.12zm-4.12 0L9.94 11 11 9.94 8.88 7.82 6.76 9.94 7.82 11zM12 17.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg>';
    } else if (G.st.hap > 60) {
        m = 'Feliz';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg>';
    } else {
        m = 'Normal';
        i = '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm-1.5 3h10v2H7z"/></svg>';
    }

    $.moodI.innerHTML = i;
    $.moodT.textContent = m;
}

function updTime() {
    const d = new Date();
    $.time.textContent = String(d.getHours()).padStart(2, '0') + ':' + String(d.getMinutes()).padStart(2, '0');
}

function showMsg(t) {
    $.msg.textContent = t;
}

function notif(t) {
    document.querySelectorAll('.notif').forEach(n => n.remove());
    const n = document.createElement('div');
    n.className = 'notif';
    n.textContent = t;
    document.body.appendChild(n);
    setTimeout(() => n.remove(), 2500);
}

function showFloat(t) {
    const f = document.createElement('div');
    f.className = 'float';
    f.textContent = t;
    f.style.left = '50%';
    f.style.top = '30%';
    f.style.transform = 'translateX(-50%)';
    $.arena.appendChild(f);
    setTimeout(() => f.remove(), 1500);
}

function save() {
    try {
        localStorage.setItem('squirtle_save', JSON.stringify(G));
    } catch (e) {}
}

function load() {
    try {
        const s = localStorage.getItem('squirtle_save');
        if (s) {
            const l = JSON.parse(s);
            G = { ...G, ...l };

            if (G.sleepEnd && G.sleepEnd < Date.now()) {
                G.status = 'idle';
                G.sleepEnd = null;
            }

            if (G.trainStart) {
                G.trainStart = Date.now();
            }

            G.lastUpd = Date.now();
        }
    } catch (e) {}
}

function reset() {
    if (!confirm('Resetar todo o progresso?')) return;

    G = {
        lv: 1,
        xp: 0,
        xpMax: 100,
        coins: 50,
        age: 0,
        st: { h: 100, hap: 100, en: 100, hp: 100 },
        status: 'idle',
        lastUpd: Date.now(),
        lastInt: Date.now(),
        start: Date.now(),
        sleepEnd: null,
        trainStart: null
    };

    $.sprite.src = ANIMS.happy;
    $.sleepT.textContent = 'Dormir';
    showMsg('Novo comeco!');
    updUI();
    save();
}

init();
</script>
</body>
</html>
