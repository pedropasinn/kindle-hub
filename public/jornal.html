<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullet Journal Digital - Pedro 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a1a;
            --text-light: #666666;
            --border: #000000;
            --border-light: #cccccc;
            --accent: #000000;
            --cor-espiritual: #dc2626;
            --cor-linguas: #2563eb;
            --cor-academico: #059669;
            --cor-fisico: #0891b2;
            --cor-literatura: #7c3aed;
            --cor-financeiro: #d97706;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 16px;
            line-height: 1.6;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .app { display: flex; flex-direction: column; min-height: 100vh; }

        .header {
            border-bottom: 2px solid var(--border);
            padding: 12px 16px;
            background: var(--bg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .header h1 { font-size: 1.25rem; font-weight: 700; letter-spacing: 0.05em; }
        .header-date { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-light); }

        .nav-tabs {
            display: flex;
            gap: 4px;
            overflow-x: auto;
            padding-bottom: 4px;
            -webkit-overflow-scrolling: touch;
        }
        .nav-tabs::-webkit-scrollbar { display: none; }

        .nav-tab {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 6px 10px;
            border: 1px solid var(--border-light);
            background: var(--bg);
            cursor: pointer;
            white-space: nowrap;
        }
        .nav-tab:active, .nav-tab.active {
            background: var(--border);
            color: var(--bg);
            border-color: var(--border);
        }

        .main { flex: 1; padding: 16px; max-width: 800px; margin: 0 auto; width: 100%; }

        .card {
            border: 2px solid var(--border);
            padding: 16px;
            margin-bottom: 16px;
            background: var(--bg);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: var(--bg);
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn:active { background: var(--border); color: var(--bg); }
        .btn-small { padding: 4px 8px; font-size: 0.65rem; border-width: 1px; }
        .btn-icon { padding: 4px 8px; font-size: 1rem; line-height: 1; }

        input, textarea, select {
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 1rem;
            padding: 8px;
            border: 1px solid var(--border-light);
            background: var(--bg);
            width: 100%;
        }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--border); }

        .key-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 12px;
        }
        .key-item { display: flex; align-items: center; gap: 4px; }
        .key-symbol { width: 18px; text-align: center; font-weight: 500; }

        .entry {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px dotted var(--border-light);
        }
        .entry:last-child { border-bottom: none; }
        .entry-symbol {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            width: 20px;
            text-align: center;
            cursor: pointer;
            flex-shrink: 0;
        }
        .entry-content { flex: 1; min-width: 0; }
        .entry-text { word-wrap: break-word; }
        .entry-text.completed { text-decoration: line-through; color: var(--text-light); }
        .entry-text.migrated { color: var(--text-light); }
        .entry-actions button {
            font-size: 0.7rem;
            padding: 2px 6px;
            border: 1px solid var(--border-light);
            background: var(--bg);
            cursor: pointer;
        }

        .add-entry {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
        }
        .add-entry select { width: auto; }
        .add-entry input { flex: 1; }

        .tracker-grid { display: grid; gap: 4px; }
        .tracker-row {
            display: grid;
            grid-template-columns: 140px repeat(7, 1fr);
            gap: 2px;
            align-items: center;
            font-size: 0.85rem;
        }
        .tracker-header {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            text-transform: uppercase;
            font-weight: 500;
            text-align: center;
        }
        .tracker-label {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.75rem;
        }
        .tracker-cell {
            width: 100%;
            aspect-ratio: 1;
            min-height: 28px;
            border: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
        }
        .tracker-cell.checked { background: var(--border); color: var(--bg); }
        .tracker-cell.na { background: #f5f5f5; color: #ccc; cursor: default; }

        .badge {
            display: inline-block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            padding: 2px 5px;
            border-radius: 2px;
            text-transform: uppercase;
        }
        .badge-espiritual { background: #fecaca; color: var(--cor-espiritual); border: 1px solid var(--cor-espiritual); }
        .badge-linguas { background: #bfdbfe; color: var(--cor-linguas); border: 1px solid var(--cor-linguas); }
        .badge-academico { background: #a7f3d0; color: var(--cor-academico); border: 1px solid var(--cor-academico); }
        .badge-fisico { background: #a5f3fc; color: var(--cor-fisico); border: 1px solid var(--cor-fisico); }
        .badge-literatura { background: #ddd6fe; color: var(--cor-literatura); border: 1px solid var(--cor-literatura); }
        .badge-financeiro { background: #fed7aa; color: var(--cor-financeiro); border: 1px solid var(--cor-financeiro); }

        .special-day {
            background: #fef2f2;
            border: 1px solid var(--cor-espiritual);
            padding: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        .special-day strong { color: var(--cor-espiritual); }

        .schedule-item {
            display: grid;
            grid-template-columns: 50px 1fr;
            gap: 8px;
            padding: 4px 0;
            border-bottom: 1px dotted var(--border-light);
            font-size: 0.9rem;
        }
        .schedule-time { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-light); }
        .schedule-event.special { color: var(--cor-espiritual); font-weight: 600; }

        .habit-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px dotted var(--border-light);
        }
        .habit-check {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .habit-check.checked { background: var(--cor-espiritual); color: white; border-color: var(--cor-espiritual); }

        .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .week-day { border: 1px solid var(--border-light); min-height: 120px; }
        .week-day-header {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            padding: 6px;
            border-bottom: 1px solid var(--border-light);
            background: #f5f5f5;
            display: flex;
            justify-content: space-between;
        }
        .week-day-header.today { background: var(--border); color: var(--bg); }
        .week-day-header.special { background: var(--cor-espiritual); color: white; }
        .week-day-content { padding: 6px; font-size: 0.75rem; }

        .month-calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 16px; }
        .month-calendar-header { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-align: center; padding: 4px; font-weight: 500; }
        .month-calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2px;
            cursor: pointer;
            font-size: 0.75rem;
        }
        .month-calendar-day.today { border: 2px solid var(--border); font-weight: 700; }
        .month-calendar-day.special { background: #fef2f2; }
        .month-calendar-day .day-number { font-family: 'JetBrains Mono', monospace; }
        .month-calendar-day .day-dot { width: 4px; height: 4px; background: var(--border); border-radius: 50%; margin-top: 2px; }

        .future-month { margin-bottom: 16px; }
        .future-month-title { font-weight: 700; padding: 8px; background: var(--border); color: var(--bg); margin-bottom: 8px; }

        .project-card { border-left: 4px solid var(--border); padding-left: 12px; margin-bottom: 16px; }
        .project-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 4px; }
        .project-meta { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: var(--text-light); margin-bottom: 8px; }

        .index-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted var(--border-light);
            cursor: pointer;
        }
        .index-item:hover { background: #f5f5f5; }
        .index-page { font-family: 'JetBrains Mono', monospace; color: var(--text-light); }

        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.3);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--bg);
            border: 2px solid var(--border);
            padding: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
        .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-light); }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; text-transform: uppercase; margin-bottom: 4px; color: var(--text-light); }

        @media (max-width: 600px) {
            .week-grid { grid-template-columns: 1fr; }
            .tracker-row { grid-template-columns: 100px repeat(7, 1fr); }
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--border-light); }

        .flex { display: flex; }
        .flex-between { justify-content: space-between; }
        .gap-8 { gap: 8px; }
        .mb-8 { margin-bottom: 8px; }
        .mb-16 { margin-bottom: 16px; }
        .mt-8 { margin-top: 8px; }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-top">
                <h1>BULLET JOURNAL</h1>
                <span class="header-date" id="header-date"></span>
            </div>
            <nav class="nav-tabs" id="nav-tabs">
                <button class="nav-tab active" data-view="dia">Dia</button>
                <button class="nav-tab" data-view="semana">Semana</button>
                <button class="nav-tab" data-view="mes">Mês</button>
                <button class="nav-tab" data-view="plano">Plano de Vida</button>
                <button class="nav-tab" data-view="estudo">Estudo</button>
                <button class="nav-tab" data-view="future">Future</button>
                <button class="nav-tab" data-view="projetos">Projetos</button>
                <button class="nav-tab" data-view="indice">Índice</button>
            </nav>
        </header>
        <main class="main" id="main-content"></main>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal-content"></div>
    </div>

    <script>
    const BuJo = {
        state: {
            currentView: 'dia',
            currentDate: new Date(),
            selectedDate: new Date(),
            entries: [],
            spiritualHabits: {},   // { 'YYYY-MM-DD': { habitId: true/false } }
            studyHabits: {},       // { 'YYYY-MM-DD': { habitId: minutes } }
            mortifications: {},    // { 'YYYY-MM-DD': [{ text, done }] }
            projects: [],
            futureLog: [],
        },

        symbols: {
            task: '•',
            taskDone: '✕',
            taskMigrated: '→',
            event: '○',
            note: '–',
            important: '★',
        },

        // 15 hábitos espirituais diários
        dailySpiritualHabits: [
            { id: 'serviam', name: 'Sérviam' },
            { id: 'preces', name: 'Preces' },
            { id: 'oracao-manha', name: 'Oração da manhã' },
            { id: 'santa-missa', name: 'Santa Missa' },
            { id: 'leitura-espiritual', name: 'Leitura Espiritual' },
            { id: 'leitura-nt', name: 'Leitura do NT' },
            { id: 'angelus', name: 'Angelus' },
            { id: 'visita-santissimo', name: 'Visita ao Santíssimo' },
            { id: 'lembrai-vos', name: 'Lembrai-vos' },
            { id: 'terco', name: 'Terço' },
            { id: 'oracao-tarde', name: 'Oração da tarde' },
            { id: 'contemplacao', name: 'Contemplação' },
            { id: 'exame', name: 'Exame' },
            { id: '2-horas', name: '2 horas' },
            { id: '3-ave-marias', name: '3 Ave Marias' },
        ],

        // Hábitos especiais semanais
        weeklySpecialHabits: {
            2: [{ id: 'turno', name: 'Dia de Turno' }], // Terça
            3: [{ id: 'guarda', name: 'Dia de Guarda' }, { id: 'disciplina', name: 'Disciplina' }], // Quarta
            6: [{ id: 'oracao-nossa-senhora', name: 'Oração a Nossa Senhora' }, { id: 'mortificacao-extra', name: 'Mortificação Extra' }], // Sábado
        },

        // Hábitos de estudo
        studyHabitsList: [
            { id: 'latim', name: 'Latim', dimension: 'linguas', target: 45 },
            { id: 'japones', name: 'Japonês', dimension: 'linguas', target: 120 },
            { id: 'estatistica', name: 'Estatística', dimension: 'academico', target: 180 },
            { id: 'literatura', name: 'Leitura', dimension: 'literatura', target: 60 },
            { id: 'tenis-mesa', name: 'Tênis de Mesa', dimension: 'fisico', target: 90 },
        ],

        // Rotina semanal
        weeklySchedule: {
            0: [ // Domingo
                { time: '10:00', event: 'Latim (2h)' },
                { time: '14:00', event: 'Estatística (3h)' },
                { time: '17:30', event: 'Japonês' },
            ],
            1: [ // Segunda
                { time: '05:45', event: 'Acordar' },
                { time: '08:15', event: 'Ida IME (Terço)' },
                { time: '09:00', event: 'Latim' },
                { time: '10:00', event: 'Aula IME' },
                { time: '12:00', event: 'Volta (Leit. Espir.)' },
                { time: '13:30', event: 'Estatística' },
                { time: '15:30', event: 'Tênis de Mesa', special: true },
                { time: '18:30', event: 'Oração' },
            ],
            2: [ // Terça - DIA DE TURNO
                { time: '05:45', event: 'Acordar' },
                { time: '08:15', event: 'Ida IME (Terço)' },
                { time: '09:00', event: 'Latim' },
                { time: '10:00', event: 'Aula IME' },
                { time: '13:30', event: 'Tempo da tarde' },
                { time: '18:00', event: 'Japonês (2h)' },
                { time: '★', event: 'DIA DE TURNO', special: true },
            ],
            3: [ // Quarta - DIA DE GUARDA + DISCIPLINA
                { time: '05:45', event: 'Acordar' },
                { time: '08:15', event: 'Ida IME (Terço)' },
                { time: '09:00', event: 'Latim' },
                { time: '10:00', event: 'Aula IME' },
                { time: '13:45', event: 'Estatística' },
                { time: '17:30', event: 'Disciplina', special: true },
                { time: '18:00', event: 'Leitura' },
                { time: '★', event: 'DIA DE GUARDA', special: true },
            ],
            4: [ // Quinta
                { time: '05:45', event: 'Acordar' },
                { time: '08:15', event: 'Ida IME (Terço)' },
                { time: '09:00', event: 'Latim' },
                { time: '10:00', event: 'Aula IME' },
                { time: '13:45', event: 'Estatística' },
                { time: '18:00', event: 'Japonês (2h)' },
            ],
            5: [ // Sexta
                { time: '05:45', event: 'Acordar' },
                { time: '08:15', event: 'Ida IME (Terço)' },
                { time: '09:00', event: 'Latim' },
                { time: '10:00', event: 'Aula IME' },
                { time: '13:30', event: 'Estatística' },
                { time: '15:30', event: 'Tênis de Mesa', special: true },
                { time: '18:00', event: 'Leitura' },
            ],
            6: [ // Sábado - NOSSA SENHORA + MORTIFICAÇÃO
                { time: '10:00', event: 'Tênis de Mesa', special: true },
                { time: '14:00', event: 'Estatística (3h)' },
                { time: '18:00', event: 'Leitura' },
                { time: '★', event: 'Oração N. Senhora', special: true },
                { time: '★', event: 'Mortificação Extra', special: true },
            ],
        },

        dimensions: [
            { id: 'espiritual', name: 'Espiritual' },
            { id: 'linguas', name: 'Línguas' },
            { id: 'academico', name: 'Acadêmico' },
            { id: 'fisico', name: 'Físico' },
            { id: 'literatura', name: 'Literatura' },
            { id: 'financeiro', name: 'Financeiro' },
        ],

        // ========== INICIALIZAÇÃO ==========
        init() {
            this.loadState();
            this.bindEvents();
            this.updateHeaderDate();
            this.render();
        },

        loadState() {
            const saved = localStorage.getItem('bujo-pedro-2026-v2');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    this.state = { ...this.state, ...parsed };
                    this.state.currentDate = new Date();
                    this.state.selectedDate = new Date(parsed.selectedDate || new Date());
                } catch (e) {
                    console.error('Erro ao carregar estado:', e);
                }
            }
        },

        saveState() {
            localStorage.setItem('bujo-pedro-2026-v2', JSON.stringify(this.state));
        },

        bindEvents() {
            document.getElementById('nav-tabs').addEventListener('click', (e) => {
                if (e.target.classList.contains('nav-tab')) {
                    this.setView(e.target.dataset.view);
                }
            });
            document.getElementById('modal-overlay').addEventListener('click', (e) => {
                if (e.target.id === 'modal-overlay') this.closeModal();
            });
        },

        setView(view) {
            this.state.currentView = view;
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.view === view);
            });
            this.render();
        },

        updateHeaderDate() {
            document.getElementById('header-date').textContent = new Date().toLocaleDateString('pt-BR', {
                weekday: 'short', day: 'numeric', month: 'short', year: 'numeric'
            }).toUpperCase();
        },

        // ========== RENDERIZAÇÃO PRINCIPAL ==========
        render() {
            const main = document.getElementById('main-content');
            switch (this.state.currentView) {
                case 'dia': main.innerHTML = this.renderDayView(); break;
                case 'semana': main.innerHTML = this.renderWeekView(); break;
                case 'mes': main.innerHTML = this.renderMonthView(); break;
                case 'plano': main.innerHTML = this.renderPlanoVida(); break;
                case 'estudo': main.innerHTML = this.renderEstudo(); break;
                case 'future': main.innerHTML = this.renderFutureLog(); break;
                case 'projetos': main.innerHTML = this.renderProjects(); break;
                case 'indice': main.innerHTML = this.renderIndex(); break;
            }
            this.bindViewEvents();
        },

        bindViewEvents() {
            // Navegação
            document.getElementById('prev-date')?.addEventListener('click', () => this.navigateDate(-1));
            document.getElementById('next-date')?.addEventListener('click', () => this.navigateDate(1));
            document.getElementById('prev-week')?.addEventListener('click', () => this.navigateWeek(-1));
            document.getElementById('next-week')?.addEventListener('click', () => this.navigateWeek(1));
            document.getElementById('prev-month')?.addEventListener('click', () => this.navigateMonth(-1));
            document.getElementById('next-month')?.addEventListener('click', () => this.navigateMonth(1));

            // Hábitos espirituais
            document.querySelectorAll('.spiritual-check').forEach(el => {
                el.addEventListener('click', () => {
                    this.toggleSpiritualHabit(el.dataset.habit, el.dataset.date);
                });
            });

            // Hábitos de estudo
            document.querySelectorAll('.study-input').forEach(el => {
                el.addEventListener('change', () => {
                    this.updateStudyHabit(el.dataset.habit, el.dataset.date, parseInt(el.value) || 0);
                });
            });

            // Entradas
            document.getElementById('add-entry-btn')?.addEventListener('click', () => this.addEntry());
            document.getElementById('add-entry-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.addEntry();
            });
            document.querySelectorAll('.entry-symbol[data-id]').forEach(el => {
                el.addEventListener('click', () => this.cycleEntrySymbol(el.dataset.id));
            });
            document.querySelectorAll('.entry-delete').forEach(el => {
                el.addEventListener('click', () => this.deleteEntry(el.dataset.id));
            });

            // Mortificações
            document.getElementById('add-mort-btn')?.addEventListener('click', () => this.showAddMortModal());
            document.querySelectorAll('.mort-check').forEach(el => {
                el.addEventListener('click', () => this.toggleMortification(el.dataset.date, parseInt(el.dataset.index)));
            });

            // Projetos e Future
            document.getElementById('add-project-btn')?.addEventListener('click', () => this.showAddProjectModal());
            document.getElementById('add-future-btn')?.addEventListener('click', () => this.showAddFutureModal());

            // Calendário mensal
            document.querySelectorAll('.month-calendar-day[data-date]').forEach(el => {
                el.addEventListener('click', () => {
                    this.state.selectedDate = new Date(el.dataset.date + 'T12:00:00');
                    this.setView('dia');
                });
            });
        },

        // ========== VIEW: DIA ==========
        renderDayView() {
            const date = this.state.selectedDate;
            const dateStr = this.formatDateKey(date);
            const dayOfWeek = date.getDay();
            const dayEntries = this.state.entries.filter(e => e.date === dateStr);
            const schedule = this.weeklySchedule[dayOfWeek] || [];
            const specialHabits = this.weeklySpecialHabits[dayOfWeek] || [];
            const isThirdSunday = this.isThirdSunday(date);

            return `
                <div class="card">
                    <div class="card-title">
                        <div class="flex gap-8" style="align-items: center;">
                            <button class="btn btn-icon" id="prev-date">←</button>
                            <span>${date.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                            <button class="btn btn-icon" id="next-date">→</button>
                        </div>
                        ${this.isToday(date) ? '<span class="badge" style="background:#000;color:#fff;">HOJE</span>' : ''}
                    </div>

                    ${specialHabits.length > 0 || isThirdSunday ? `
                        <div class="special-day">
                            <strong>★ Dia Especial:</strong>
                            ${specialHabits.map(h => h.name).join(' • ')}
                            ${isThirdSunday ? ' • Sýmbolum Athanasiánum' : ''}
                        </div>
                    ` : ''}

                    <div style="margin-bottom: 16px;">
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 8px;">
                            Rotina de ${this.getDayName(dayOfWeek)}
                        </div>
                        ${schedule.map(item => `
                            <div class="schedule-item">
                                <span class="schedule-time">${item.time}</span>
                                <span class="schedule-event ${item.special ? 'special' : ''}">${item.event}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Plano de Vida do Dia -->
                <div class="card">
                    <div class="card-title">Plano de Vida</div>
                    ${this.renderDaySpiritualHabits(dateStr, dayOfWeek, isThirdSunday)}
                </div>

                <!-- Mortificações -->
                <div class="card">
                    <div class="card-title">
                        Mortificações
                        <button class="btn btn-small" id="add-mort-btn">+ Add</button>
                    </div>
                    ${this.renderMortifications(dateStr)}
                </div>

                <!-- Registro Rápido -->
                <div class="card">
                    <div class="card-title">Registro Rápido</div>
                    <div class="key-legend">
                        <div class="key-item"><span class="key-symbol">${this.symbols.task}</span> tarefa</div>
                        <div class="key-item"><span class="key-symbol">${this.symbols.event}</span> evento</div>
                        <div class="key-item"><span class="key-symbol">${this.symbols.note}</span> nota</div>
                    </div>
                    <div>
                        ${dayEntries.length === 0 ? '<p style="color: var(--text-light); font-style: italic;">Nenhuma entrada...</p>' : 
                          dayEntries.map(e => this.renderEntry(e)).join('')}
                    </div>
                    <div class="add-entry">
                        <select id="add-entry-type">
                            <option value="task">${this.symbols.task}</option>
                            <option value="event">${this.symbols.event}</option>
                            <option value="note">${this.symbols.note}</option>
                        </select>
                        <input type="text" id="add-entry-input" placeholder="Digite...">
                        <button class="btn btn-small" id="add-entry-btn">+</button>
                    </div>
                </div>
            `;
        },

        renderDaySpiritualHabits(dateStr, dayOfWeek, isThirdSunday) {
            const dayHabits = this.state.spiritualHabits[dateStr] || {};
            const specialHabits = this.weeklySpecialHabits[dayOfWeek] || [];

            let html = '';

            // Hábitos diários
            this.dailySpiritualHabits.forEach(habit => {
                const checked = dayHabits[habit.id] || false;
                html += `
                    <div class="habit-row">
                        <span>${habit.name}</span>
                        <div class="habit-check spiritual-check ${checked ? 'checked' : ''}" data-habit="${habit.id}" data-date="${dateStr}">
                            ${checked ? '✓' : ''}
                        </div>
                    </div>
                `;
            });

            // Hábitos especiais do dia
            if (specialHabits.length > 0) {
                html += '<div style="margin-top: 12px; padding-top: 8px; border-top: 2px solid var(--cor-espiritual);"><strong style="color: var(--cor-espiritual);">★ Especial</strong></div>';
                specialHabits.forEach(habit => {
                    const checked = dayHabits[habit.id] || false;
                    html += `
                        <div class="habit-row" style="background: #fef2f2;">
                            <span style="font-weight: 600;">${habit.name}</span>
                            <div class="habit-check spiritual-check ${checked ? 'checked' : ''}" data-habit="${habit.id}" data-date="${dateStr}">
                                ${checked ? '✓' : ''}
                            </div>
                        </div>
                    `;
                });
            }

            // 3º Domingo
            if (isThirdSunday) {
                const checked = dayHabits['symbolum-athanasianum'] || false;
                html += `
                    <div class="habit-row" style="background: #fef2f2; margin-top: 8px;">
                        <span style="font-weight: 600;">Sýmbolum Athanasiánum</span>
                        <div class="habit-check spiritual-check ${checked ? 'checked' : ''}" data-habit="symbolum-athanasianum" data-date="${dateStr}">
                            ${checked ? '✓' : ''}
                        </div>
                    </div>
                `;
            }

            return html;
        },

        renderMortifications(dateStr) {
            const morts = this.state.mortifications[dateStr] || [];
            if (morts.length === 0) {
                return '<p style="color: var(--text-light); font-style: italic; font-size: 0.9rem;">Nenhuma mortificação registrada.</p>';
            }
            return morts.map((m, i) => `
                <div class="habit-row">
                    <span style="${m.done ? 'text-decoration: line-through; color: var(--text-light);' : ''}">${m.text}</span>
                    <div class="habit-check mort-check ${m.done ? 'checked' : ''}" data-date="${dateStr}" data-index="${i}">
                        ${m.done ? '✓' : ''}
                    </div>
                </div>
            `).join('');
        },

        renderEntry(entry) {
            const symbol = entry.type === 'note' ? this.symbols.note :
                          entry.type === 'event' ? this.symbols.event :
                          entry.status === 'done' ? this.symbols.taskDone :
                          entry.status === 'migrated' ? this.symbols.taskMigrated :
                          this.symbols.task;
            const textClass = entry.status === 'done' ? 'completed' : entry.status === 'migrated' ? 'migrated' : '';
            return `
                <div class="entry">
                    <span class="entry-symbol" data-id="${entry.id}">${symbol}</span>
                    <div class="entry-content">
                        <span class="entry-text ${textClass}">${entry.text}</span>
                    </div>
                    <button class="entry-delete" data-id="${entry.id}">×</button>
                </div>
            `;
        },

        // ========== VIEW: PLANO DE VIDA (TRACKER SEMANAL) ==========
        renderPlanoVida() {
            const weekDays = this.getWeekDays(this.state.selectedDate);
            const weekLabels = weekDays.map(d => ({
                label: d.toLocaleDateString('pt-BR', { weekday: 'short' }).substring(0, 3),
                date: this.formatDateKey(d),
                dayOfWeek: d.getDay(),
                isToday: this.isToday(d),
                isThirdSunday: this.isThirdSunday(d)
            }));

            return `
                <div class="card">
                    <div class="card-title">
                        <div class="flex gap-8" style="align-items: center;">
                            <button class="btn btn-icon" id="prev-week">←</button>
                            <span>Plano de Vida</span>
                            <button class="btn btn-icon" id="next-week">→</button>
                        </div>
                    </div>

                    <div class="tracker-grid">
                        <div class="tracker-row">
                            <div class="tracker-header">Hábito</div>
                            ${weekLabels.map(d => `
                                <div class="tracker-header" style="${d.isToday ? 'font-weight: bold; text-decoration: underline;' : ''}">
                                    ${d.label}<br>${d.date.split('-')[2]}
                                </div>
                            `).join('')}
                        </div>

                        <!-- Hábitos diários -->
                        <div style="grid-column: 1 / -1; padding: 6px 0 2px; border-top: 1px solid var(--border-light); margin-top: 4px;">
                            <span class="badge badge-espiritual">Diários (15)</span>
                        </div>
                        ${this.dailySpiritualHabits.map(habit => `
                            <div class="tracker-row">
                                <div class="tracker-label">${habit.name}</div>
                                ${weekLabels.map(d => {
                                    const dayHabits = this.state.spiritualHabits[d.date] || {};
                                    const checked = dayHabits[habit.id] || false;
                                    return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="${habit.id}" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                                }).join('')}
                            </div>
                        `).join('')}

                        <!-- Hábitos especiais -->
                        <div style="grid-column: 1 / -1; padding: 6px 0 2px; border-top: 1px solid var(--border-light); margin-top: 4px;">
                            <span class="badge badge-espiritual">Semanais</span>
                        </div>

                        <!-- Terça: Turno -->
                        <div class="tracker-row">
                            <div class="tracker-label">Dia de Turno</div>
                            ${weekLabels.map(d => {
                                if (d.dayOfWeek !== 2) return '<div class="tracker-cell na">–</div>';
                                const dayHabits = this.state.spiritualHabits[d.date] || {};
                                const checked = dayHabits['turno'] || false;
                                return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="turno" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                            }).join('')}
                        </div>

                        <!-- Quarta: Guarda -->
                        <div class="tracker-row">
                            <div class="tracker-label">Dia de Guarda</div>
                            ${weekLabels.map(d => {
                                if (d.dayOfWeek !== 3) return '<div class="tracker-cell na">–</div>';
                                const dayHabits = this.state.spiritualHabits[d.date] || {};
                                const checked = dayHabits['guarda'] || false;
                                return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="guarda" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                            }).join('')}
                        </div>

                        <!-- Quarta: Disciplina -->
                        <div class="tracker-row">
                            <div class="tracker-label">Disciplina</div>
                            ${weekLabels.map(d => {
                                if (d.dayOfWeek !== 3) return '<div class="tracker-cell na">–</div>';
                                const dayHabits = this.state.spiritualHabits[d.date] || {};
                                const checked = dayHabits['disciplina'] || false;
                                return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="disciplina" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                            }).join('')}
                        </div>

                        <!-- Sábado: Nossa Senhora -->
                        <div class="tracker-row">
                            <div class="tracker-label">Oração N. Senhora</div>
                            ${weekLabels.map(d => {
                                if (d.dayOfWeek !== 6) return '<div class="tracker-cell na">–</div>';
                                const dayHabits = this.state.spiritualHabits[d.date] || {};
                                const checked = dayHabits['oracao-nossa-senhora'] || false;
                                return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="oracao-nossa-senhora" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                            }).join('')}
                        </div>

                        <!-- Sábado: Mortificação Extra -->
                        <div class="tracker-row">
                            <div class="tracker-label">Mortificação Extra</div>
                            ${weekLabels.map(d => {
                                if (d.dayOfWeek !== 6) return '<div class="tracker-cell na">–</div>';
                                const dayHabits = this.state.spiritualHabits[d.date] || {};
                                const checked = dayHabits['mortificacao-extra'] || false;
                                return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="mortificacao-extra" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                            }).join('')}
                        </div>

                        <!-- 3º Domingo: Símbolo Atanasiano -->
                        <div class="tracker-row">
                            <div class="tracker-label">Symb. Athanas.</div>
                            ${weekLabels.map(d => {
                                if (!d.isThirdSunday) return '<div class="tracker-cell na">–</div>';
                                const dayHabits = this.state.spiritualHabits[d.date] || {};
                                const checked = dayHabits['symbolum-athanasianum'] || false;
                                return `<div class="tracker-cell spiritual-check ${checked ? 'checked' : ''}" data-habit="symbolum-athanasianum" data-date="${d.date}">${checked ? '✓' : ''}</div>`;
                            }).join('')}
                        </div>
                    </div>
                </div>

                <!-- Resumo -->
                <div class="card">
                    <div class="card-title">Resumo da Semana</div>
                    ${this.renderSpiritualSummary(weekLabels)}
                </div>
            `;
        },

        renderSpiritualSummary(weekLabels) {
            let totalChecked = 0;
            let totalPossible = 0;

            weekLabels.forEach(d => {
                const dayHabits = this.state.spiritualHabits[d.date] || {};
                this.dailySpiritualHabits.forEach(habit => {
                    totalPossible++;
                    if (dayHabits[habit.id]) totalChecked++;
                });
                // Especiais
                if (d.dayOfWeek === 2) { totalPossible++; if (dayHabits['turno']) totalChecked++; }
                if (d.dayOfWeek === 3) { totalPossible += 2; if (dayHabits['guarda']) totalChecked++; if (dayHabits['disciplina']) totalChecked++; }
                if (d.dayOfWeek === 6) { totalPossible += 2; if (dayHabits['oracao-nossa-senhora']) totalChecked++; if (dayHabits['mortificacao-extra']) totalChecked++; }
                if (d.isThirdSunday) { totalPossible++; if (dayHabits['symbolum-athanasianum']) totalChecked++; }
            });

            const percent = totalPossible > 0 ? Math.round((totalChecked / totalPossible) * 100) : 0;

            return `
                <div style="text-align: center; padding: 16px;">
                    <div style="font-size: 2.5rem; font-weight: 700;">${percent}%</div>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--text-light);">
                        ${totalChecked} de ${totalPossible} práticas
                    </div>
                    <div style="margin-top: 12px; background: #eee; height: 10px; border-radius: 5px;">
                        <div style="width: ${percent}%; background: var(--cor-espiritual); height: 100%; border-radius: 5px;"></div>
                    </div>
                </div>
            `;
        },

        // ========== VIEW: ESTUDO ==========
        renderEstudo() {
            const weekDays = this.getWeekDays(this.state.selectedDate);
            const weekLabels = weekDays.map(d => ({
                label: d.toLocaleDateString('pt-BR', { weekday: 'short' }).substring(0, 3),
                date: this.formatDateKey(d),
                isToday: this.isToday(d)
            }));

            return `
                <div class="card">
                    <div class="card-title">
                        <div class="flex gap-8" style="align-items: center;">
                            <button class="btn btn-icon" id="prev-week">←</button>
                            <span>Tracker de Estudo</span>
                            <button class="btn btn-icon" id="next-week">→</button>
                        </div>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 12px;">Registre o tempo em minutos.</p>

                    <div class="tracker-grid">
                        <div class="tracker-row">
                            <div class="tracker-header">Atividade</div>
                            ${weekLabels.map(d => `<div class="tracker-header" style="${d.isToday ? 'font-weight: bold;' : ''}">${d.label}</div>`).join('')}
                        </div>

                        ${this.studyHabitsList.map(habit => `
                            <div class="tracker-row">
                                <div class="tracker-label">
                                    <span class="badge badge-${habit.dimension}">${habit.dimension.substring(0,3)}</span>
                                    ${habit.name}
                                </div>
                                ${weekLabels.map(d => {
                                    const dayStudy = this.state.studyHabits[d.date] || {};
                                    const minutes = dayStudy[habit.id] || 0;
                                    const reached = minutes >= habit.target;
                                    return `
                                        <div style="text-align: center;">
                                            <input type="number" class="study-input" data-habit="${habit.id}" data-date="${d.date}"
                                                   value="${minutes}" min="0"
                                                   style="width: 100%; text-align: center; padding: 4px; font-size: 0.75rem; ${reached ? 'background: #a7f3d0;' : ''}">
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Resumo -->
                <div class="card">
                    <div class="card-title">Resumo Semanal</div>
                    ${this.renderStudySummary(weekLabels)}
                </div>
            `;
        },

        renderStudySummary(weekLabels) {
            return this.studyHabitsList.map(habit => {
                let total = 0;
                weekLabels.forEach(d => {
                    const dayStudy = this.state.studyHabits[d.date] || {};
                    total += dayStudy[habit.id] || 0;
                });
                const hours = Math.floor(total / 60);
                const mins = total % 60;
                return `
                    <div class="flex flex-between mb-8" style="align-items: center;">
                        <span class="badge badge-${habit.dimension}">${habit.name}</span>
                        <span style="font-family: 'JetBrains Mono', monospace;">${hours}h ${mins}min</span>
                    </div>
                `;
            }).join('');
        },

        // ========== VIEW: SEMANA ==========
        renderWeekView() {
            const weekDays = this.getWeekDays(this.state.selectedDate);
            return `
                <div class="card">
                    <div class="card-title">
                        <div class="flex gap-8" style="align-items: center;">
                            <button class="btn btn-icon" id="prev-week">←</button>
                            <span>Semana</span>
                            <button class="btn btn-icon" id="next-week">→</button>
                        </div>
                    </div>
                    <div class="week-grid">
                        ${weekDays.map(day => {
                            const dateStr = this.formatDateKey(day);
                            const dayOfWeek = day.getDay();
                            const schedule = this.weeklySchedule[dayOfWeek] || [];
                            const isToday = this.isToday(day);
                            const isSpecial = (this.weeklySpecialHabits[dayOfWeek] || []).length > 0;
                            return `
                                <div class="week-day">
                                    <div class="week-day-header ${isToday ? 'today' : ''} ${isSpecial ? 'special' : ''}">
                                        <span>${day.toLocaleDateString('pt-BR', { weekday: 'short' })}</span>
                                        <span>${day.getDate()}</span>
                                    </div>
                                    <div class="week-day-content">
                                        ${schedule.slice(0, 5).map(item => `<div style="border-bottom: 1px dotted var(--border-light); padding: 2px 0;">${item.time !== '★' ? item.time + ' ' : ''}${item.event}</div>`).join('')}
                                        ${schedule.length > 5 ? `<div style="color: var(--text-light);">+${schedule.length - 5}</div>` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        },

        // ========== VIEW: MÊS ==========
        renderMonthView() {
            const date = this.state.selectedDate;
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startPadding = firstDay.getDay();

            return `
                <div class="card">
                    <div class="card-title">
                        <div class="flex gap-8" style="align-items: center;">
                            <button class="btn btn-icon" id="prev-month">←</button>
                            <span style="text-transform: capitalize;">${date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</span>
                            <button class="btn btn-icon" id="next-month">→</button>
                        </div>
                    </div>
                    <div style="font-size: 0.75rem; margin-bottom: 8px; color: var(--text-light);">
                        <span style="background: #fef2f2; padding: 2px 6px;">★ Dia especial</span>
                        Ter: Turno | Qua: Guarda | Sáb: N.Senhora | 3º Dom: Athanas.
                    </div>
                    <div class="month-calendar">
                        ${['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'].map(d => `<div class="month-calendar-header">${d}</div>`).join('')}
                        ${Array(startPadding).fill('<div class="month-calendar-day" style="background:#f9f9f9;"></div>').join('')}
                        ${Array.from({ length: lastDay.getDate() }, (_, i) => {
                            const dayDate = new Date(year, month, i + 1);
                            const dateStr = this.formatDateKey(dayDate);
                            const dayOfWeek = dayDate.getDay();
                            const isToday = this.isToday(dayDate);
                            const isSpecial = dayOfWeek === 2 || dayOfWeek === 3 || dayOfWeek === 6 || this.isThirdSunday(dayDate);
                            const hasHabits = this.state.spiritualHabits[dateStr] && Object.keys(this.state.spiritualHabits[dateStr]).length > 0;
                            return `
                                <div class="month-calendar-day ${isToday ? 'today' : ''} ${isSpecial ? 'special' : ''}" data-date="${dateStr}">
                                    <span class="day-number">${i + 1}</span>
                                    ${hasHabits ? '<div class="day-dot"></div>' : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        },

        // ========== VIEW: FUTURE LOG ==========
        renderFutureLog() {
            const now = new Date();
            const months = [];
            for (let i = 0; i < 12; i++) {
                const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
                months.push({ key: this.getMonthKey(d), name: d.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }) });
            }

            return `
                <div class="card">
                    <div class="card-title">
                        Future Log
                        <button class="btn btn-small" id="add-future-btn">+ Add</button>
                    </div>
                    ${months.map(m => {
                        const entries = this.state.futureLog.filter(e => e.month === m.key);
                        return `
                            <div class="future-month">
                                <div class="future-month-title" style="text-transform: capitalize;">${m.name}</div>
                                <div style="padding-left: 8px;">
                                    ${entries.length === 0 ? '<p style="color: var(--text-light); font-style: italic; font-size: 0.85rem;">–</p>' :
                                      entries.map(e => `<div class="entry"><span class="entry-symbol">${e.day || '–'}</span><div class="entry-content">${e.text}</div><button class="entry-delete" data-id="${e.id}">×</button></div>`).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        },

        // ========== VIEW: PROJETOS ==========
        renderProjects() {
            return `
                <div class="card">
                    <div class="card-title">
                        Projetos Ativos
                        <button class="btn btn-small" id="add-project-btn">+ Novo</button>
                    </div>
                    ${this.state.projects.length === 0 ? '<p style="color: var(--text-light); font-style: italic;">Nenhum projeto.</p>' :
                      this.state.projects.map(p => `
                        <div class="project-card" style="border-left-color: var(--cor-${p.dimension || 'academico'});">
                            <div class="project-title">${p.name}</div>
                            <div class="project-meta">${p.status || 'Em andamento'}</div>
                            ${p.nextAction ? `<p>→ ${p.nextAction}</p>` : ''}
                        </div>
                      `).join('')}
                </div>
                <div class="card">
                    <div class="card-title">Projetos 2026 (Referência)</div>
                    <div style="font-size: 0.9rem;">
                        <p class="mb-8"><span class="badge badge-linguas">Línguas</span> Gradus Primus + Japonês N5→N4</p>
                        <p class="mb-8"><span class="badge badge-academico">Acadêmico</span> Mestrado IME-USP</p>
                        <p class="mb-8"><span class="badge badge-literatura">Literatura</span> Obra de Machado de Assis</p>
                        <p><span class="badge badge-fisico">Físico</span> TM Seg/Qua/Sex + Sáb</p>
                    </div>
                </div>
            `;
        },

        // ========== VIEW: ÍNDICE ==========
        renderIndex() {
            return `
                <div class="card">
                    <div class="card-title">Índice</div>
                    <div style="margin-bottom: 16px; padding: 12px; background: #f5f5f5;">
                        <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 8px;">Legenda</div>
                        <div class="key-legend" style="border: none; margin: 0; padding: 0;">
                            <div class="key-item"><span class="key-symbol">${this.symbols.task}</span> tarefa</div>
                            <div class="key-item"><span class="key-symbol">${this.symbols.taskDone}</span> feito</div>
                            <div class="key-item"><span class="key-symbol">${this.symbols.taskMigrated}</span> migrado</div>
                            <div class="key-item"><span class="key-symbol">${this.symbols.event}</span> evento</div>
                            <div class="key-item"><span class="key-symbol">${this.symbols.note}</span> nota</div>
                        </div>
                    </div>
                    ${[
                        { name: 'Registro Diário', view: 'dia', desc: 'Rotina + Plano de Vida + Registro' },
                        { name: 'Visão Semanal', view: 'semana', desc: 'Rotina da semana' },
                        { name: 'Pacote Mensal', view: 'mes', desc: 'Calendário mensal' },
                        { name: 'Plano de Vida', view: 'plano', desc: '15 hábitos diários + especiais' },
                        { name: 'Tracker de Estudo', view: 'estudo', desc: 'Latim, Japonês, Estatística...' },
                        { name: 'Future Log', view: 'future', desc: 'Próximos 12 meses' },
                        { name: 'Projetos', view: 'projetos', desc: 'Projetos ativos' },
                    ].map(col => `
                        <div class="index-item" onclick="BuJo.setView('${col.view}')">
                            <div><strong>${col.name}</strong><br><small style="color: var(--text-light);">${col.desc}</small></div>
                            <span class="index-page">→</span>
                        </div>
                    `).join('')}
                </div>
                <div class="card">
                    <div class="card-title">Dias Especiais</div>
                    <p class="mb-8"><strong>Terça:</strong> Dia de Turno</p>
                    <p class="mb-8"><strong>Quarta:</strong> Dia de Guarda + Disciplina</p>
                    <p class="mb-8"><strong>Sábado:</strong> Oração a N. Senhora + Mortificação Extra</p>
                    <p><strong>3º Domingo:</strong> Sýmbolum Athanasiánum</p>
                </div>
                <div class="card">
                    <div class="card-title">Estatísticas</div>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
                        <p>Entradas: ${this.state.entries.length}</p>
                        <p>Projetos: ${this.state.projects.length}</p>
                        <p>Dias com plano: ${Object.keys(this.state.spiritualHabits).length}</p>
                        <p>Future Log: ${this.state.futureLog.length}</p>
                    </div>
                </div>
            `;
        },

        // ========== AÇÕES ==========
        addEntry() {
            const input = document.getElementById('add-entry-input');
            const type = document.getElementById('add-entry-type').value;
            const text = input.value.trim();
            if (!text) return;
            this.state.entries.push({
                id: this.generateId(),
                date: this.formatDateKey(this.state.selectedDate),
                type, text, status: 'pending', createdAt: new Date().toISOString()
            });
            this.saveState();
            input.value = '';
            this.render();
        },

        cycleEntrySymbol(id) {
            const entry = this.state.entries.find(e => e.id === id);
            if (!entry) return;
            if (entry.type === 'task') {
                const cycle = ['pending', 'done', 'migrated'];
                entry.status = cycle[(cycle.indexOf(entry.status) + 1) % cycle.length];
            }
            this.saveState();
            this.render();
        },

        deleteEntry(id) {
            this.state.entries = this.state.entries.filter(e => e.id !== id);
            this.saveState();
            this.render();
        },

        toggleSpiritualHabit(habitId, dateStr) {
            if (!this.state.spiritualHabits[dateStr]) this.state.spiritualHabits[dateStr] = {};
            this.state.spiritualHabits[dateStr][habitId] = !this.state.spiritualHabits[dateStr][habitId];
            this.saveState();
            this.render();
        },

        updateStudyHabit(habitId, dateStr, minutes) {
            if (!this.state.studyHabits[dateStr]) this.state.studyHabits[dateStr] = {};
            this.state.studyHabits[dateStr][habitId] = minutes;
            this.saveState();
        },

        toggleMortification(dateStr, index) {
            if (this.state.mortifications[dateStr]?.[index]) {
                this.state.mortifications[dateStr][index].done = !this.state.mortifications[dateStr][index].done;
                this.saveState();
                this.render();
            }
        },

        showAddMortModal() {
            const dateStr = this.formatDateKey(this.state.selectedDate);
            this.showModal(`
                <div class="modal-title">Adicionar Mortificação</div>
                <form id="mort-form">
                    <div class="form-group">
                        <label>Descrição</label>
                        <input type="text" id="mort-text" required placeholder="Ex: Jejum até o almoço">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn" onclick="BuJo.closeModal()">Cancelar</button>
                        <button type="submit" class="btn">Adicionar</button>
                    </div>
                </form>
            `);
            document.getElementById('mort-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const text = document.getElementById('mort-text').value.trim();
                if (text) {
                    if (!this.state.mortifications[dateStr]) this.state.mortifications[dateStr] = [];
                    this.state.mortifications[dateStr].push({ text, done: false });
                    this.saveState();
                    this.closeModal();
                    this.render();
                }
            });
        },

        showAddProjectModal() {
            this.showModal(`
                <div class="modal-title">Novo Projeto</div>
                <form id="project-form">
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="project-name" required>
                    </div>
                    <div class="form-group">
                        <label>Dimensão</label>
                        <select id="project-dimension">
                            ${this.dimensions.map(d => `<option value="${d.id}">${d.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Próxima Ação</label>
                        <input type="text" id="project-next">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn" onclick="BuJo.closeModal()">Cancelar</button>
                        <button type="submit" class="btn">Criar</button>
                    </div>
                </form>
            `);
            document.getElementById('project-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.state.projects.push({
                    id: this.generateId(),
                    name: document.getElementById('project-name').value,
                    dimension: document.getElementById('project-dimension').value,
                    nextAction: document.getElementById('project-next').value,
                    status: 'Em andamento',
                    createdAt: new Date().toISOString()
                });
                this.saveState();
                this.closeModal();
                this.render();
            });
        },

        showAddFutureModal() {
            const now = new Date();
            const months = [];
            for (let i = 0; i < 12; i++) {
                const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
                months.push({ key: this.getMonthKey(d), name: d.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }) });
            }
            this.showModal(`
                <div class="modal-title">Adicionar ao Future Log</div>
                <form id="future-form">
                    <div class="form-group">
                        <label>Mês</label>
                        <select id="future-month">${months.map(m => `<option value="${m.key}">${m.name}</option>`).join('')}</select>
                    </div>
                    <div class="form-group">
                        <label>Dia (opcional)</label>
                        <input type="number" id="future-day" min="1" max="31">
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <input type="text" id="future-text" required>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn" onclick="BuJo.closeModal()">Cancelar</button>
                        <button type="submit" class="btn">Adicionar</button>
                    </div>
                </form>
            `);
            document.getElementById('future-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.state.futureLog.push({
                    id: this.generateId(),
                    month: document.getElementById('future-month').value,
                    day: document.getElementById('future-day').value || null,
                    text: document.getElementById('future-text').value,
                    createdAt: new Date().toISOString()
                });
                this.saveState();
                this.closeModal();
                this.render();
            });
        },

        navigateDate(delta) {
            this.state.selectedDate = new Date(this.state.selectedDate.getTime() + delta * 86400000);
            this.render();
        },

        navigateWeek(delta) {
            this.state.selectedDate = new Date(this.state.selectedDate.getTime() + delta * 7 * 86400000);
            this.render();
        },

        navigateMonth(delta) {
            const d = this.state.selectedDate;
            this.state.selectedDate = new Date(d.getFullYear(), d.getMonth() + delta, 1);
            this.render();
        },

        showModal(content) {
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal-overlay').classList.add('active');
        },

        closeModal() {
            document.getElementById('modal-overlay').classList.remove('active');
        },

        // ========== UTILITÁRIOS ==========
        generateId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); },

        formatDateKey(date) {
            const d = new Date(date);
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        },

        getMonthKey(date) {
            const d = new Date(date);
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        },

        getWeekDays(date) {
            const d = new Date(date);
            const diff = d.getDate() - d.getDay();
            return Array.from({ length: 7 }, (_, i) => new Date(d.getFullYear(), d.getMonth(), diff + i));
        },

        isToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
        },

        isThirdSunday(date) {
            if (date.getDay() !== 0) return false;
            const day = date.getDate();
            return day >= 15 && day <= 21;
        },

        getDayName(dow) {
            return ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'][dow];
        }
    };

    document.addEventListener('DOMContentLoaded', () => BuJo.init());
    </script>
</body>
</html>